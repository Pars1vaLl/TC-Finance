var te=Object.defineProperty;var re=(s,a,i)=>a in s?te(s,a,{enumerable:!0,configurable:!0,writable:!0,value:i}):s[a]=i;var L=(s,a,i)=>(re(s,typeof a!="symbol"?a+"":a,i),i);import{r as h,b as ae,a as ne}from"./vendor-fb33f09a.js";import{N as se,u as ie,a as oe,b as I,O as ce,R as le,c as C,B as de}from"./router-4648b3ef.js";import{V as y,O as me}from"./auth-e19147ab.js";import{R as F,B as he,C as J,X as G,Y as V,T as M,L as D,a as U,b as ue,c as ge,P as pe,d as fe,e as ye}from"./charts-edc0c9d0.js";(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const o of r)if(o.type==="childList")for(const c of o.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&n(c)}).observe(document,{childList:!0,subtree:!0});function i(r){const o={};return r.integrity&&(o.integrity=r.integrity),r.referrerPolicy&&(o.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?o.credentials="include":r.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(r){if(r.ep)return;r.ep=!0;const o=i(r);fetch(r.href,o)}})();var K={exports:{}},P={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var xe=h,Ne=Symbol.for("react.element"),be=Symbol.for("react.fragment"),ve=Object.prototype.hasOwnProperty,we=xe.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Se={key:!0,ref:!0,__self:!0,__source:!0};function H(s,a,i){var n,r={},o=null,c=null;i!==void 0&&(o=""+i),a.key!==void 0&&(o=""+a.key),a.ref!==void 0&&(c=a.ref);for(n in a)ve.call(a,n)&&!Se.hasOwnProperty(n)&&(r[n]=a[n]);if(s&&s.defaultProps)for(n in a=s.defaultProps,a)r[n]===void 0&&(r[n]=a[n]);return{$$typeof:Ne,type:s,key:o,ref:c,props:r,_owner:we.current}}P.Fragment=be;P.jsx=H;P.jsxs=H;K.exports=P;var $=K.exports;const R=$.Fragment,e=$.jsx,t=$.jsxs;var A={},z=ae;A.createRoot=z.createRoot,A.hydrateRoot=z.hydrateRoot;function Ce(){const s=new Uint8Array(32);return crypto.getRandomValues(s),btoa(String.fromCharCode(...s)).replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}async function ke(s){const i=new TextEncoder().encode(s),n=await crypto.subtle.digest("SHA-256",i);return btoa(String.fromCharCode(...new Uint8Array(n))).replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}const B={}.VITE_GOOGLE_CLIENT_ID||"your-google-client-id",q=window.location.origin+"/auth/callback",_e="https://accounts.google.com/o/oauth2/v2/auth",Te="https://oauth2.googleapis.com/token",Ee="https://www.googleapis.com/oauth2/v2/userinfo",Le=["openid","profile","email"].join(" "),w=class w{constructor(){L(this,"codeVerifier",null)}static getInstance(){return w.instance||(w.instance=new w),w.instance}async login(){try{this.codeVerifier=Ce();const a=await ke(this.codeVerifier);sessionStorage.setItem("code_verifier",this.codeVerifier);const i=new URL(_e);i.searchParams.set("client_id",B),i.searchParams.set("redirect_uri",q),i.searchParams.set("response_type","code"),i.searchParams.set("scope",Le),i.searchParams.set("code_challenge",a),i.searchParams.set("code_challenge_method","S256"),i.searchParams.set("access_type","offline"),i.searchParams.set("prompt","consent"),window.location.href=i.toString()}catch(a){throw console.error("Login error:",a),new Error("Failed to initiate login")}}async handleCallback(a){try{const i=sessionStorage.getItem("code_verifier");if(!i)throw new Error("No code verifier found");const n=await fetch(Te,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({client_id:B,redirect_uri:q,code:a,code_verifier:i,grant_type:"authorization_code"})});if(!n.ok)throw new Error("Failed to exchange code for tokens");const r=await n.json(),o=await fetch(Ee,{headers:{Authorization:`Bearer ${r.access_token}`}});if(!o.ok)throw new Error("Failed to get user info");const c=await o.json();return localStorage.setItem("auth_token",r.access_token),localStorage.setItem("id_token",r.id_token),localStorage.setItem("user_data",JSON.stringify(c)),sessionStorage.removeItem("code_verifier"),c}catch(i){throw console.error("Callback error:",i),new Error("Failed to complete authentication")}}logout(){localStorage.removeItem("auth_token"),localStorage.removeItem("id_token"),localStorage.removeItem("user_data"),sessionStorage.removeItem("code_verifier"),window.location.href="/login"}getStoredUser(){const a=localStorage.getItem("user_data");if(a)try{return JSON.parse(a)}catch(i){return console.error("Error parsing user data:",i),null}return null}getStoredToken(){return localStorage.getItem("auth_token")}isAuthenticated(){return!!this.getStoredToken()&&!!this.getStoredUser()}getUserRole(a){var n;const i=(n=a.split("@")[1])==null?void 0:n.toLowerCase();return i==="admin.yourcompany.com"?"Admin":i==="warehouse.yourcompany.com"?"Clerk":"Viewer"}};L(w,"instance");let W=w;const v=W.getInstance(),Y=h.createContext(void 0),j=()=>{const s=h.useContext(Y);if(s===void 0)throw new Error("useAuth must be used within an AuthProvider");return s},Pe=({children:s})=>{const[a,i]=h.useState(null),[n,r]=h.useState(!0);h.useEffect(()=>{(()=>{try{const d=v.getStoredUser(),l=v.getStoredToken();if(d&&l){const g={id:d.id,email:d.email,name:d.name,picture:d.picture,role:v.getUserRole(d.email)};i(g)}}catch(d){console.error("Error initializing auth:",d),v.logout()}finally{r(!1)}})()},[]);const p={user:a,loading:n,login:async()=>{try{r(!0),await v.login()}catch(f){throw console.error("Login error:",f),r(!1),f}},logout:()=>{i(null),v.logout()},isAuthenticated:!!a};return e(Y.Provider,{value:p,children:s})},Re=({children:s})=>{const{isAuthenticated:a,loading:i}=j();return i?e("div",{className:"flex h-screen items-center justify-center bg-gray-50",children:t("div",{className:"text-center",children:[e("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-primary-600 mx-auto"}),e("p",{className:"mt-4 text-gray-600",children:"Loading..."})]})}):a?e(R,{children:s}):e(se,{to:"/login",replace:!0})},je=()=>{const[s]=ie(),a=oe(),[i,n]=h.useState(null);return h.useEffect(()=>{(async()=>{try{const o=s.get("code"),c=s.get("error");if(c){n(`Authentication failed: ${c}`),y.error("Authentication failed"),setTimeout(()=>a("/login"),3e3);return}if(!o){n("No authorization code received"),y.error("No authorization code received"),setTimeout(()=>a("/login"),3e3);return}await v.handleCallback(o),y.success("Successfully logged in!"),a("/",{replace:!0})}catch(o){console.error("Auth callback error:",o),n("Failed to complete authentication"),y.error("Failed to complete authentication"),setTimeout(()=>a("/login"),3e3)}})()},[s,a]),i?e("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:e("div",{className:"max-w-md w-full space-y-8",children:t("div",{className:"text-center",children:[e("h2",{className:"text-2xl font-bold text-gray-900",children:"Authentication Error"}),e("p",{className:"mt-2 text-sm text-gray-600",children:i}),e("p",{className:"mt-4 text-sm text-gray-500",children:"Redirecting to login..."})]})})}):e("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:e("div",{className:"max-w-md w-full space-y-8",children:t("div",{className:"text-center",children:[e("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-primary-600 mx-auto"}),e("h2",{className:"mt-6 text-2xl font-bold text-gray-900",children:"Completing Login"}),e("p",{className:"mt-2 text-sm text-gray-600",children:"Please wait while we complete your authentication..."})]})})})},Oe=({onMenuClick:s})=>{const{user:a,logout:i}=j();return e("header",{className:"bg-white shadow-sm border-b border-gray-200",children:t("div",{className:"flex h-16 items-center justify-between px-4 sm:px-6",children:[t("div",{className:"flex items-center",children:[e("button",{onClick:s,className:"lg:hidden p-2 rounded-md text-gray-400 hover:text-gray-500 hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-primary-500",children:e("svg",{className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 6h16M4 12h16M4 18h16"})})}),e("h1",{className:"text-lg sm:text-xl font-semibold text-gray-900 ml-2 lg:ml-0",children:"Warehouse Analytics"})]}),e("div",{className:"flex items-center space-x-2 sm:space-x-4",children:a&&t(R,{children:[t("div",{className:"hidden sm:flex items-center space-x-2",children:[e("img",{className:"h-8 w-8 rounded-full",src:a.picture||"/default-avatar.png",alt:a.name||"User"}),t("div",{className:"flex flex-col",children:[e("span",{className:"text-sm font-medium text-gray-700",children:a.name}),e("span",{className:"text-xs text-gray-500 capitalize",children:a.role})]})]}),t("div",{className:"sm:hidden flex items-center space-x-2",children:[e("img",{className:"h-6 w-6 rounded-full",src:a.picture||"/default-avatar.png",alt:a.name||"User"}),e("span",{className:"text-sm font-medium text-gray-700 truncate max-w-20",children:a.name})]}),t("button",{onClick:i,className:"text-sm text-gray-500 hover:text-gray-700 transition-colors px-2 py-1 rounded hover:bg-gray-100",children:[e("span",{className:"hidden sm:inline",children:"Logout"}),e("span",{className:"sm:hidden",children:"Exit"})]})]})})]})})},Ae=({isOpen:s=!1,onClose:a})=>{const{user:i}=j(),r=[{name:"Dashboard",href:"/",icon:"📊",roles:["Admin","Clerk","Viewer"]},{name:"New Transaction",href:"/transaction",icon:"➕",roles:["Admin","Clerk"]},{name:"Reference Data",href:"/reference",icon:"📋",roles:["Admin"]}].filter(o=>i&&o.roles.includes(i.role));return t(R,{children:[e("div",{className:`lg:hidden fixed inset-y-0 left-0 z-50 w-64 bg-white shadow-lg transform transition-transform duration-300 ease-in-out ${s?"translate-x-0":"-translate-x-full"}`,children:t("div",{className:"flex h-full flex-col",children:[t("div",{className:"flex h-16 items-center justify-between px-6",children:[e("h2",{className:"text-lg font-semibold text-gray-900",children:"WPA"}),e("button",{onClick:a,className:"p-2 rounded-md text-gray-400 hover:text-gray-500 hover:bg-gray-100",children:e("svg",{className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e("div",{className:"flex-1 space-y-1 px-3 py-4",children:r.map(o=>t(I,{to:o.href,onClick:a,className:({isActive:c})=>`flex items-center px-3 py-3 text-sm font-medium rounded-md transition-colors ${c?"bg-primary-100 text-primary-700":"text-gray-600 hover:bg-gray-50 hover:text-gray-900"}`,children:[e("span",{className:"mr-3 text-lg",children:o.icon}),o.name]},o.name))}),e("div",{className:"border-t border-gray-200 p-4",children:t("div",{className:"text-xs text-gray-500",children:["Logged in as: ",(i==null?void 0:i.role)||"Unknown"]})})]})}),e("nav",{className:"hidden lg:block fixed inset-y-0 left-0 z-40 w-64 bg-white shadow-lg",children:t("div",{className:"flex h-full flex-col",children:[e("div",{className:"flex h-16 items-center px-6",children:e("h2",{className:"text-lg font-semibold text-gray-900",children:"WPA"})}),e("div",{className:"flex-1 space-y-1 px-3 py-4",children:r.map(o=>t(I,{to:o.href,className:({isActive:c})=>`flex items-center px-3 py-2 text-sm font-medium rounded-md transition-colors ${c?"bg-primary-100 text-primary-700":"text-gray-600 hover:bg-gray-50 hover:text-gray-900"}`,children:[e("span",{className:"mr-3",children:o.icon}),o.name]},o.name))}),e("div",{className:"border-t border-gray-200 p-4",children:t("div",{className:"text-xs text-gray-500",children:["Logged in as: ",(i==null?void 0:i.role)||"Unknown"]})})]})})]})},We=()=>{const[s,a]=h.useState(!1);return t("div",{className:"min-h-screen bg-gray-50",children:[s&&e("div",{className:"fixed inset-0 z-40 bg-black bg-opacity-50 lg:hidden",onClick:()=>a(!1)}),e(Ae,{isOpen:s,onClose:()=>a(!1)}),t("div",{className:"lg:pl-64",children:[e(Oe,{onMenuClick:()=>a(!0)}),e("main",{className:"p-4 sm:p-6 lg:p-8",children:e(ce,{})})]})]})},Fe=()=>{const{login:s,loading:a}=j();return e("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 py-12 px-4 sm:px-6 lg:px-8",children:t("div",{className:"max-w-md w-full space-y-8",children:[t("div",{children:[e("div",{className:"mx-auto h-12 w-12 flex items-center justify-center rounded-full bg-primary-100",children:e("span",{className:"text-2xl",children:"📊"})}),e("h2",{className:"mt-6 text-center text-3xl font-extrabold text-gray-900",children:"Warehouse Profit Analytics"}),e("p",{className:"mt-2 text-center text-sm text-gray-600",children:"Sign in to access your warehouse data"})]}),e("div",{className:"mt-8 space-y-6",children:e("button",{onClick:async()=>{try{await s()}catch(n){console.error("Login failed:",n)}},disabled:a,className:"group relative w-full flex justify-center py-2 px-4 border border-transparent text-sm font-medium rounded-md text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:a?t("div",{className:"flex items-center",children:[e("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Signing in..."]}):t(R,{children:[t("svg",{className:"w-5 h-5 mr-2",viewBox:"0 0 24 24",children:[e("path",{fill:"currentColor",d:"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"}),e("path",{fill:"currentColor",d:"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"}),e("path",{fill:"currentColor",d:"M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"}),e("path",{fill:"currentColor",d:"M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"})]}),"Sign in with Google"]})})})]})})},Me={}.VITE_GOOGLE_SHEETS_API_URL;class De{constructor(a){L(this,"baseUrl");this.baseUrl=a}async request(a,i={}){try{const n=`${this.baseUrl}?path=${a}`,r=await fetch(n,{...i,headers:{"Content-Type":"application/json",...i.headers}});if(!r.ok){const c=await r.json().catch(()=>({}));throw new Error(c.error||`HTTP ${r.status}`)}return{data:await r.json()}}catch(n){return console.error(`API request failed for ${a}:`,n),{error:n instanceof Error?n.message:"Unknown error"}}}async getMetadata(){return this.request("meta")}async createTransaction(a){return this.request("txn",{method:"POST",body:JSON.stringify(a)})}async createWarehouse(a){return this.request("warehouse",{method:"POST",body:JSON.stringify(a)})}async createCostType(a){return this.request("costType",{method:"POST",body:JSON.stringify(a)})}async getReport(a){return this.request(`report&month=${a}`)}async getSnapshot(a){return this.request(`snapshot&month=${a}`)}}const k=new De(Me||""),T={getMetadata:()=>k.getMetadata(),createTransaction:s=>k.createTransaction(s),createWarehouse:s=>k.createWarehouse(s),createCostType:s=>k.createCostType(s),getReport:s=>k.getReport(s),getSnapshot:s=>k.getSnapshot(s)},X=()=>{const s=new Date;return`${s.getFullYear()}-${String(s.getMonth()+1).padStart(2,"0")}`},$e=s=>{const[a,i]=s.split("-");return new Date(parseInt(a),parseInt(i)-1).toLocaleDateString("en-US",{year:"numeric",month:"long"})},Ie=s=>{const[a,i]=h.useState(null),[n,r]=h.useState(!0),[o,c]=h.useState(null),[p,f]=h.useState(s||X()),d=async()=>{try{r(!0),c(null);const g=await T.getReport(p);if(g.error){c(g.error);return}g.data&&i(g.data)}catch(g){c(g instanceof Error?g.message:"Failed to fetch report")}finally{r(!1)}};return h.useEffect(()=>{d()},[p]),{report:a,loading:n,error:o,refetch:d,setMonth:g=>{f(g)},currentMonth:p}},Ue=({summary:s,loading:a=!1})=>{if(a)return e("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-4 lg:gap-6 mb-6",children:[1,2,3,4].map(n=>e("div",{className:"card",children:t("div",{className:"animate-pulse",children:[e("div",{className:"h-3 bg-gray-200 rounded w-3/4 mb-2"}),e("div",{className:"h-6 bg-gray-200 rounded w-1/2"})]})},n))});const i=[{title:"Total Revenue",value:s.totalRevenue,change:"+12.5%",changeType:"positive",icon:"💰",color:"bg-green-50 border-green-200",textColor:"text-green-600"},{title:"Total Expenses",value:s.totalExpenses,change:"+8.2%",changeType:"negative",icon:"💸",color:"bg-red-50 border-red-200",textColor:"text-red-600"},{title:"Gross Profit",value:s.grossProfit,change:s.profitMargin>0?"+15.3%":"-5.2%",changeType:s.profitMargin>0?"positive":"negative",icon:"📈",color:s.profitMargin>0?"bg-blue-50 border-blue-200":"bg-yellow-50 border-yellow-200",textColor:s.profitMargin>0?"text-blue-600":"text-yellow-600"},{title:"Profit Margin",value:s.profitMargin,change:"+2.8%",changeType:"positive",icon:"📊",color:"bg-purple-50 border-purple-200",textColor:"text-purple-600",isPercentage:!0}];return e("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-4 lg:gap-6 mb-6",children:i.map((n,r)=>e("div",{className:`card border-2 ${n.color}`,children:t("div",{className:"flex items-center justify-between",children:[t("div",{className:"flex-1 min-w-0",children:[e("p",{className:"text-xs lg:text-sm font-medium text-gray-600 truncate",children:n.title}),e("p",{className:`text-lg lg:text-2xl font-bold ${n.textColor} truncate`,children:n.isPercentage?`${n.value.toFixed(1)}%`:`${n.value.toLocaleString()} TJS`}),t("p",{className:`text-xs font-medium ${n.changeType==="positive"?"text-green-600":"text-red-600"}`,children:[n.change," from last month"]})]}),e("div",{className:"text-2xl lg:text-3xl ml-2 flex-shrink-0",children:n.icon})]})},r))})},ze=({warehouses:s,loading:a=!1})=>{if(a)return t("div",{className:"card",children:[e("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Revenue vs Profit by Warehouse"}),t("div",{className:"flex items-center justify-center py-12",children:[e("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600"}),e("span",{className:"ml-2 text-gray-600",children:"Loading chart..."})]})]});if(!s||s.length===0)return t("div",{className:"card",children:[e("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Revenue vs Profit by Warehouse"}),e("div",{className:"text-center py-12",children:e("p",{className:"text-gray-500",children:"No data available for this period"})})]});const i=s.map(n=>({name:n.name,revenue:n.revenue,profit:n.profit,emoji:n.emoji}));return t("div",{className:"card",children:[e("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Revenue vs Profit by Warehouse"}),e(F,{width:"100%",height:250,className:"sm:h-[300px]",children:t(he,{data:i,margin:{top:20,right:10,left:10,bottom:5},children:[e(J,{strokeDasharray:"3 3"}),e(G,{dataKey:"name",tick:{fontSize:11},tickFormatter:n=>{const r=i.find(o=>o.name===n);return r?`${r.emoji} ${n.substring(0,8)}...`:n},angle:-45,textAnchor:"end",height:60}),e(V,{tickFormatter:n=>`${(n/1e3).toFixed(0)}k`,tick:{fontSize:11},width:50}),e(M,{formatter:(n,r)=>[`${n.toLocaleString()} TJS`,r==="revenue"?"Revenue":"Profit"],labelFormatter:n=>{const r=i.find(o=>o.name===n);return r?`${n} ${r.emoji}`:n}}),e(D,{wrapperStyle:{fontSize:"12px"}}),e(U,{dataKey:"revenue",fill:"#10B981",name:"Revenue"}),e(U,{dataKey:"profit",fill:"#3B82F6",name:"Profit"})]})})]})},Be=({warehouses:s,loading:a=!1})=>{if(a)return t("div",{className:"card",children:[e("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Profit Margin by Warehouse"}),t("div",{className:"flex items-center justify-center py-12",children:[e("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600"}),e("span",{className:"ml-2 text-gray-600",children:"Loading chart..."})]})]});if(!s||s.length===0)return t("div",{className:"card",children:[e("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Profit Margin by Warehouse"}),e("div",{className:"text-center py-12",children:e("p",{className:"text-gray-500",children:"No data available for this period"})})]});const i=s.map(n=>({name:n.name,margin:n.margin,emoji:n.emoji}));return t("div",{className:"card",children:[e("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Profit Margin by Warehouse"}),e(F,{width:"100%",height:250,className:"sm:h-[300px]",children:t(ue,{data:i,margin:{top:20,right:10,left:10,bottom:5},children:[e(J,{strokeDasharray:"3 3"}),e(G,{dataKey:"name",tick:{fontSize:11},tickFormatter:n=>{const r=i.find(o=>o.name===n);return r?`${r.emoji} ${n.substring(0,8)}...`:n},angle:-45,textAnchor:"end",height:60}),e(V,{tickFormatter:n=>`${n.toFixed(1)}%`,tick:{fontSize:11},width:50}),e(M,{formatter:n=>[`${n.toFixed(2)}%`,"Profit Margin"],labelFormatter:n=>{const r=i.find(o=>o.name===n);return r?`${n} ${r.emoji}`:n}}),e(D,{wrapperStyle:{fontSize:"12px"}}),e(ge,{type:"monotone",dataKey:"margin",stroke:"#8B5CF6",strokeWidth:3,dot:{fill:"#8B5CF6",strokeWidth:2,r:4},activeDot:{r:6}})]})})]})},qe=({warehouses:s,loading:a=!1})=>{if(a)return t("div",{className:"card",children:[e("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Warehouse Performance Distribution"}),t("div",{className:"flex items-center justify-center py-12",children:[e("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600"}),e("span",{className:"ml-2 text-gray-600",children:"Loading chart..."})]})]});if(!s||s.length===0)return t("div",{className:"card",children:[e("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Warehouse Performance Distribution"}),e("div",{className:"text-center py-12",children:e("p",{className:"text-gray-500",children:"No data available for this period"})})]});const i=s.filter(r=>r.revenue>0).map(r=>({name:r.name,value:r.revenue,profit:r.profit,margin:r.margin,emoji:r.emoji,color:r.color}));if(i.length===0)return t("div",{className:"card",children:[e("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Warehouse Performance Distribution"}),e("div",{className:"text-center py-12",children:e("p",{className:"text-gray-500",children:"No revenue data available for this period"})})]});const n=["#3B82F6","#10B981","#F59E0B","#EF4444","#8B5CF6","#06B6D4"];return t("div",{className:"card",children:[e("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Warehouse Performance Distribution"}),e(F,{width:"100%",height:250,className:"sm:h-[300px]",children:t(pe,{children:[e(fe,{data:i,cx:"50%",cy:"50%",labelLine:!1,label:({name:r,percent:o})=>`${r.substring(0,6)}... ${(o*100).toFixed(0)}%`,outerRadius:60,fill:"#8884d8",dataKey:"value",children:i.map((r,o)=>e(ye,{fill:r.color||n[o%n.length]},`cell-${o}`))}),e(M,{formatter:(r,o,c)=>[`${r.toLocaleString()} TJS`,`${c.payload.name} ${c.payload.emoji}`]}),e(D,{layout:"horizontal",verticalAlign:"bottom",align:"center",wrapperStyle:{fontSize:"11px",paddingTop:"10px"},formatter:(r,o)=>t("span",{style:{color:o.color},children:[o.payload.name.substring(0,8),"... ",o.payload.emoji]})})]})})]})},Je=()=>{var g,N;const[s,a]=h.useState(X()),[i,n]=h.useState("all"),{report:r,loading:o,error:c,refetch:p}=Ie(s),f=m=>{a(m.target.value)},d=m=>{n(m.target.value)},l=i==="all"?(r==null?void 0:r.warehouses)||[]:((g=r==null?void 0:r.warehouses)==null?void 0:g.filter(m=>m.id===i))||[];return c?t("div",{className:"space-y-6",children:[t("div",{children:[e("h1",{className:"text-2xl font-bold text-gray-900",children:"Dashboard"}),e("p",{className:"text-gray-600",children:"Warehouse profit analytics overview"})]}),e("div",{className:"card",children:t("div",{className:"text-center py-12",children:[t("p",{className:"text-red-600",children:["Error loading dashboard: ",c]}),e("button",{onClick:()=>p(),className:"mt-4 btn btn-primary",children:"Retry"})]})})]}):t("div",{className:"space-y-6",children:[t("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between",children:[t("div",{children:[e("h1",{className:"text-2xl font-bold text-gray-900",children:"Dashboard"}),e("p",{className:"text-gray-600",children:"Warehouse profit analytics overview"})]}),t("div",{className:"flex flex-col sm:flex-row gap-4 mt-4 sm:mt-0",children:[t("div",{children:[e("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Month"}),e("select",{value:s,onChange:f,className:"input",children:Array.from({length:12},(m,E)=>{const b=new Date;b.setMonth(b.getMonth()-E);const S=b.toISOString().slice(0,7);return e("option",{value:S,children:$e(S)},S)})})]}),t("div",{children:[e("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Warehouse"}),t("select",{value:i,onChange:d,className:"input",children:[e("option",{value:"all",children:"All Warehouses"}),(N=r==null?void 0:r.warehouses)==null?void 0:N.map(m=>t("option",{value:m.id,children:[m.name," ",m.emoji]},m.id))]})]})]})]}),(r==null?void 0:r.summary)&&e(Ue,{summary:r.summary,loading:o}),t("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e(ze,{warehouses:l,loading:o}),e(Be,{warehouses:l,loading:o})]}),e("div",{className:"grid grid-cols-1 gap-6",children:e(qe,{warehouses:l,loading:o})}),(r==null?void 0:r.warehouses)&&r.warehouses.length>0&&t("div",{className:"card",children:[e("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Warehouse Details"}),e("div",{className:"overflow-x-auto",children:t("table",{className:"min-w-full divide-y divide-gray-200",children:[e("thead",{className:"bg-gray-50",children:t("tr",{children:[e("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Warehouse"}),e("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Revenue"}),e("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Expenses"}),e("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Profit"}),e("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Margin"}),e("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Transactions"})]})}),e("tbody",{className:"bg-white divide-y divide-gray-200",children:r.warehouses.map(m=>t("tr",{className:"hover:bg-gray-50",children:[e("td",{className:"px-6 py-4 whitespace-nowrap",children:t("div",{className:"flex items-center",children:[e("span",{className:"text-2xl mr-2",children:m.emoji}),e("span",{className:"font-medium text-gray-900",children:m.name})]})}),t("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:[m.revenue.toLocaleString()," TJS"]}),t("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:[m.expenses.toLocaleString()," TJS"]}),e("td",{className:"px-6 py-4 whitespace-nowrap",children:t("span",{className:`text-sm font-medium ${m.profit>=0?"text-green-600":"text-red-600"}`,children:[m.profit>=0?"+":"",m.profit.toLocaleString()," TJS"]})}),e("td",{className:"px-6 py-4 whitespace-nowrap",children:t("span",{className:`text-sm font-medium ${m.margin>=0?"text-green-600":"text-red-600"}`,children:[m.margin>=0?"+":"",m.margin.toFixed(1),"%"]})}),e("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:m.transactionCount})]},m.id))})]})})]})]})},Q=()=>{const[s,a]=h.useState([]),[i,n]=h.useState([]),[r,o]=h.useState(!0),[c,p]=h.useState(null),f=async()=>{try{o(!0),p(null);const d=await T.getMetadata();if(d.error){p(d.error);return}d.data&&(a(d.data.warehouses),n(d.data.costTypes))}catch(d){p(d instanceof Error?d.message:"Failed to fetch metadata")}finally{o(!1)}};return h.useEffect(()=>{f()},[]),{warehouses:s,costTypes:i,loading:r,error:c,refetch:f}},Ge=()=>{const{warehouses:s,costTypes:a,loading:i,error:n}=Q(),[r,o]=h.useState({date:new Date().toISOString().split("T")[0],warehouse_id:"",cost_type_id:"",is_income:!1,amount:0,currency:"TJS"}),[c,p]=h.useState(!1),f=async l=>{if(l.preventDefault(),!r.warehouse_id||!r.cost_type_id||r.amount<=0){y.error("Please fill in all required fields");return}try{p(!0);const g=await T.createTransaction(r);if(g.error){y.error(g.error);return}y.success("Transaction created successfully!"),o({date:new Date().toISOString().split("T")[0],warehouse_id:"",cost_type_id:"",is_income:!1,amount:0,currency:"TJS"})}catch{y.error("Failed to create transaction")}finally{p(!1)}},d=(l,g)=>{o(N=>({...N,[l]:g}))};return i?t("div",{className:"space-y-6",children:[t("div",{children:[e("h1",{className:"text-2xl font-bold text-gray-900",children:"New Transaction"}),e("p",{className:"text-gray-600",children:"Add a new income or expense transaction"})]}),e("div",{className:"card max-w-2xl",children:t("div",{className:"flex items-center justify-center py-12",children:[e("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600"}),e("span",{className:"ml-2 text-gray-600",children:"Loading..."})]})})]}):n?t("div",{className:"space-y-6",children:[t("div",{children:[e("h1",{className:"text-2xl font-bold text-gray-900",children:"New Transaction"}),e("p",{className:"text-gray-600",children:"Add a new income or expense transaction"})]}),e("div",{className:"card max-w-2xl",children:t("div",{className:"text-center py-12",children:[t("p",{className:"text-red-600",children:["Error loading data: ",n]}),e("button",{onClick:()=>window.location.reload(),className:"mt-4 btn btn-primary",children:"Retry"})]})})]}):t("div",{className:"space-y-6",children:[t("div",{children:[e("h1",{className:"text-2xl font-bold text-gray-900",children:"New Transaction"}),e("p",{className:"text-gray-600",children:"Add a new income or expense transaction"})]}),e("div",{className:"card max-w-2xl",children:t("form",{onSubmit:f,className:"space-y-6",children:[t("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[t("div",{children:[e("label",{className:"block text-sm font-medium text-gray-700",children:"Warehouse *"}),t("select",{className:"input mt-1",value:r.warehouse_id,onChange:l=>d("warehouse_id",l.target.value),required:!0,children:[e("option",{value:"",children:"Select warehouse..."}),s.map(l=>t("option",{value:l.id,children:[l.emoji," ",l.name]},l.id))]})]}),t("div",{children:[e("label",{className:"block text-sm font-medium text-gray-700",children:"Transaction Type *"}),t("select",{className:"input mt-1",value:r.cost_type_id,onChange:l=>d("cost_type_id",l.target.value),required:!0,children:[e("option",{value:"",children:"Select type..."}),a.map(l=>t("option",{value:l.id,children:[l.name," ",l.is_direct?"(Direct)":"(Indirect)"]},l.id))]})]})]}),t("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[t("div",{children:[e("label",{className:"block text-sm font-medium text-gray-700",children:"Amount *"}),e("input",{type:"number",className:"input mt-1",placeholder:"0.00",value:r.amount,onChange:l=>d("amount",parseFloat(l.target.value)||0),min:"0",step:"0.01",required:!0})]}),t("div",{children:[e("label",{className:"block text-sm font-medium text-gray-700",children:"Currency"}),t("select",{className:"input mt-1",value:r.currency,onChange:l=>d("currency",l.target.value),children:[e("option",{value:"TJS",children:"TJS"}),e("option",{value:"USD",children:"USD"}),e("option",{value:"EUR",children:"EUR"})]})]})]}),t("div",{children:[e("label",{className:"block text-sm font-medium text-gray-700",children:"Date"}),e("input",{type:"date",className:"input mt-1",value:r.date,onChange:l=>d("date",l.target.value)})]}),e("div",{children:t("label",{className:"flex items-center",children:[e("input",{type:"checkbox",className:"rounded border-gray-300 text-primary-600 shadow-sm focus:border-primary-300 focus:ring focus:ring-primary-200 focus:ring-opacity-50",checked:r.is_income,onChange:l=>d("is_income",l.target.checked)}),e("span",{className:"ml-2 text-sm text-gray-700",children:"This is income (not expense)"})]})}),e("div",{className:"flex justify-end",children:e("button",{type:"submit",className:"btn btn-primary",disabled:c,children:c?t("div",{className:"flex items-center",children:[e("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Saving..."]}):"Save Transaction"})})]})})]})},Ve=()=>{const{warehouses:s,costTypes:a,loading:i,error:n,refetch:r}=Q(),[o,c]=h.useState("warehouses"),[p,f]=h.useState(!1),[d,l]=h.useState(!1),[g,N]=h.useState(!1),[m,E]=h.useState({name:"",emoji:"🏢",color:"#3B82F6"}),[b,S]=h.useState({name:"",is_direct:!0}),Z=async u=>{if(u.preventDefault(),!m.name.trim()){y.error("Warehouse name is required");return}try{N(!0);const x=await T.createWarehouse(m);if(x.error){y.error(x.error);return}y.success("Warehouse created successfully!"),f(!1),E({name:"",emoji:"🏢",color:"#3B82F6"}),r()}catch{y.error("Failed to create warehouse")}finally{N(!1)}},ee=async u=>{if(u.preventDefault(),!b.name.trim()){y.error("Cost type name is required");return}try{N(!0);const x=await T.createCostType(b);if(x.error){y.error(x.error);return}y.success("Cost type created successfully!"),l(!1),S({name:"",is_direct:!0}),r()}catch{y.error("Failed to create cost type")}finally{N(!1)}},_=(u,x)=>{o==="warehouses"?E(O=>({...O,[u]:x})):S(O=>({...O,[u]:x}))};return i?t("div",{className:"space-y-6",children:[t("div",{children:[e("h1",{className:"text-2xl font-bold text-gray-900",children:"Reference Data"}),e("p",{className:"text-gray-600",children:"Manage warehouses and cost types"})]}),e("div",{className:"card",children:t("div",{className:"flex items-center justify-center py-12",children:[e("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600"}),e("span",{className:"ml-2 text-gray-600",children:"Loading..."})]})})]}):n?t("div",{className:"space-y-6",children:[t("div",{children:[e("h1",{className:"text-2xl font-bold text-gray-900",children:"Reference Data"}),e("p",{className:"text-gray-600",children:"Manage warehouses and cost types"})]}),e("div",{className:"card",children:t("div",{className:"text-center py-12",children:[t("p",{className:"text-red-600",children:["Error loading data: ",n]}),e("button",{onClick:()=>r(),className:"mt-4 btn btn-primary",children:"Retry"})]})})]}):t("div",{className:"space-y-6",children:[t("div",{children:[e("h1",{className:"text-2xl font-bold text-gray-900",children:"Reference Data"}),e("p",{className:"text-gray-600",children:"Manage warehouses and cost types"})]}),t("div",{className:"card",children:[e("div",{className:"border-b border-gray-200",children:t("nav",{className:"-mb-px flex space-x-8",children:[t("button",{className:`whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm transition-colors ${o==="warehouses"?"border-primary-500 text-primary-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,onClick:()=>c("warehouses"),children:["Warehouses (",s.length,")"]}),t("button",{className:`whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm transition-colors ${o==="costTypes"?"border-primary-500 text-primary-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,onClick:()=>c("costTypes"),children:["Cost Types (",a.length,")"]})]})}),t("div",{className:"mt-6",children:[o==="warehouses"&&t("div",{children:[t("div",{className:"flex justify-between items-center mb-4",children:[e("h3",{className:"text-lg font-medium text-gray-900",children:"Warehouses"}),e("button",{className:"btn btn-primary",onClick:()=>f(!0),children:"Add Warehouse"})]}),s.length>0?e("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:s.map(u=>t("div",{className:"border rounded-lg p-4 hover:shadow-md transition-shadow",children:[t("div",{className:"flex items-center justify-between mb-2",children:[t("div",{className:"flex items-center",children:[e("span",{className:"text-2xl mr-2",children:u.emoji}),e("span",{className:"font-medium",children:u.name})]}),e("div",{className:"w-4 h-4 rounded-full border-2 border-gray-300",style:{backgroundColor:u.color}})]}),t("div",{className:"text-sm text-gray-500",children:["ID: ",u.id.substring(0,8),"..."]})]},u.id))}):e("div",{className:"text-center py-12",children:e("p",{className:"text-gray-500",children:"No warehouses found. Add your first warehouse to get started."})})]}),o==="costTypes"&&t("div",{children:[t("div",{className:"flex justify-between items-center mb-4",children:[e("h3",{className:"text-lg font-medium text-gray-900",children:"Cost Types"}),e("button",{className:"btn btn-primary",onClick:()=>l(!0),children:"Add Cost Type"})]}),a.length>0?e("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:a.map(u=>t("div",{className:"border rounded-lg p-4 hover:shadow-md transition-shadow",children:[t("div",{className:"flex items-center justify-between mb-2",children:[e("span",{className:"font-medium",children:u.name}),e("span",{className:`text-xs font-medium px-2 py-1 rounded ${u.is_direct?"bg-blue-100 text-blue-800":"bg-orange-100 text-orange-800"}`,children:u.is_direct?"Direct":"Indirect"})]}),t("div",{className:"text-sm text-gray-500",children:["ID: ",u.id.substring(0,8),"..."]})]},u.id))}):e("div",{className:"text-center py-12",children:e("p",{className:"text-gray-500",children:"No cost types found. Add your first cost type to get started."})})]})]})]}),p&&e("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:t("div",{className:"bg-white rounded-lg p-6 w-full max-w-md",children:[e("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Add New Warehouse"}),t("form",{onSubmit:Z,className:"space-y-4",children:[t("div",{children:[e("label",{className:"block text-sm font-medium text-gray-700",children:"Name *"}),e("input",{type:"text",className:"input mt-1",value:m.name,onChange:u=>_("name",u.target.value),placeholder:"Enter warehouse name",required:!0})]}),t("div",{children:[e("label",{className:"block text-sm font-medium text-gray-700",children:"Emoji"}),e("input",{type:"text",className:"input mt-1",value:m.emoji,onChange:u=>_("emoji",u.target.value),placeholder:"🏢",maxLength:2})]}),t("div",{children:[e("label",{className:"block text-sm font-medium text-gray-700",children:"Color"}),e("input",{type:"color",className:"input mt-1 h-10",value:m.color,onChange:u=>_("color",u.target.value)})]}),t("div",{className:"flex justify-end space-x-3 pt-4",children:[e("button",{type:"button",className:"btn btn-secondary",onClick:()=>f(!1),disabled:g,children:"Cancel"}),e("button",{type:"submit",className:"btn btn-primary",disabled:g,children:g?"Creating...":"Create Warehouse"})]})]})]})}),d&&e("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:t("div",{className:"bg-white rounded-lg p-6 w-full max-w-md",children:[e("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Add New Cost Type"}),t("form",{onSubmit:ee,className:"space-y-4",children:[t("div",{children:[e("label",{className:"block text-sm font-medium text-gray-700",children:"Name *"}),e("input",{type:"text",className:"input mt-1",value:b.name,onChange:u=>_("name",u.target.value),placeholder:"Enter cost type name",required:!0})]}),e("div",{children:t("label",{className:"flex items-center",children:[e("input",{type:"checkbox",className:"rounded border-gray-300 text-primary-600 shadow-sm focus:border-primary-300 focus:ring focus:ring-primary-200 focus:ring-opacity-50",checked:b.is_direct,onChange:u=>_("is_direct",u.target.checked)}),e("span",{className:"ml-2 text-sm text-gray-700",children:"Direct cost (vs indirect cost)"})]})}),t("div",{className:"flex justify-end space-x-3 pt-4",children:[e("button",{type:"button",className:"btn btn-secondary",onClick:()=>l(!1),disabled:g,children:"Cancel"}),e("button",{type:"submit",className:"btn btn-primary",disabled:g,children:g?"Creating...":"Create Cost Type"})]})]})]})})]})};function Ke(){return e(Pe,{children:t("div",{className:"min-h-screen bg-gray-50",children:[t(le,{children:[e(C,{path:"/login",element:e(Fe,{})}),e(C,{path:"/auth/callback",element:e(je,{})}),t(C,{path:"/",element:e(Re,{children:e(We,{})}),children:[e(C,{index:!0,element:e(Je,{})}),e(C,{path:"transaction",element:e(Ge,{})}),e(C,{path:"reference",element:e(Ve,{})})]})]}),e(me,{position:"top-right",toastOptions:{duration:4e3,style:{background:"#363636",color:"#fff"},success:{duration:3e3,iconTheme:{primary:"#22c55e",secondary:"#fff"}},error:{duration:5e3,iconTheme:{primary:"#ef4444",secondary:"#fff"}}}})]})})}"serviceWorker"in navigator&&window.addEventListener("load",()=>{navigator.serviceWorker.register("/sw.js").then(s=>{console.log("SW registered: ",s)}).catch(s=>{console.log("SW registration failed: ",s)})});A.createRoot(document.getElementById("root")).render(e(ne.StrictMode,{children:e(de,{children:e(Ke,{})})}));
//# sourceMappingURL=index-76d42c83.js.map
